<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercices - mathX_searcher</title>
    
    <!-- CSS ind√©pendant -->
    <link rel="stylesheet" href="exercices.css">
    
    <!-- Font Awesome pour ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles sp√©cifiques pour les ajustements -->
    <style>
        /* ================= CORRECTIONS SP√âCIFIQUES ================= */
        
        /* Barre navigation fixe */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        /* Conteneur principal avec padding pour navigation fixe */
        main {
            padding-bottom: 100px; /* Espace pour navigation */
            min-height: calc(100vh - 180px);
        }
        
        /* Titres avec retour √† ligne */
        .file-title {
            white-space: normal; /* Retour √† ligne */
            word-break: break-word; /* Casse les mots longs */
            overflow-wrap: break-word;
            max-height: 3.6em; /* ‚âà 3 lignes max */
            overflow: hidden;
            line-height: 1.2;
        }
        
        /* Pr√©visualisation TXT avec scroll double */
        .exercise-preview {
            max-height: 120px;
            overflow: auto; /* Scroll vertical ET horizontal */
            white-space: pre-wrap; /* Conserve les sauts de ligne */
            word-wrap: break-word;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.9rem;
            padding: 12px;
            background: rgba(16, 185, 129, 0.05); /* VERT au lieu de bleu */
            border-radius: 8px;
            border: 1px solid rgba(16, 185, 129, 0.2);
            
            /* Style scrollbar */
            scrollbar-width: thin;
            scrollbar-color: #10b981 rgba(16, 185, 129, 0.1);
        }
        
        .exercise-preview::-webkit-scrollbar {
            width: 8px;
            height: 8px; /* Pour scroll horizontal */
        }
        
        .exercise-preview::-webkit-scrollbar-track {
            background: rgba(16, 185, 129, 0.1);
            border-radius: 4px;
        }
        
        .exercise-preview::-webkit-scrollbar-thumb {
            background: #10b981;
            border-radius: 4px;
        }
        
        .exercise-preview::-webkit-scrollbar-thumb:hover {
            background: #059669;
        }
        
        /* Description PDF avec retour √† ligne */
        .file-description {
            white-space: normal;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.5;
        }
        
        /* Image container adaptatif */
        .image-container {
            max-width: 100%;
            overflow: hidden;
            border-radius: 8px;
            background: rgba(16, 185, 129, 0.05); /* VERT */
            padding: 10px;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }
        
        /* Carte invisible par d√©faut */
        .result-card {
            display: none; /* Cach√©e par d√©faut */
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .result-card.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* √âtat d'accueil (visible par d√©faut) */
        .welcome-state {
            display: block;
            text-align: center;
            padding: 60px 20px;
            max-width: 800px;
            margin: 40px auto 0;
        }
        
        .welcome-state.hidden {
            display: none;
        }
        
        /* Indicateur de scroll pour cartes longues */
        .scroll-indicator {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(16, 185, 129, 0.8);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            opacity: 0.7;
            transition: opacity 0.3s ease;
            z-index: 2;
        }
        
        .scroll-indicator:hover {
            opacity: 1;
        }
        
        /* Message quand pas de recherche */
        .no-search-message {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
            font-size: 1.1rem;
        }
        
        [data-theme="dark"] .no-search-message {
            color: #94a3b8;
        }
        
        /* Bouton pour scanner les nouveaux fichiers */
        .scan-new-files {
            background: linear-gradient(135deg, #10b981, #059669); /* VERT */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 20px auto;
            transition: all 0.3s ease;
        }
        
        .scan-new-files:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }
        
        /* ================= FILTRES CHECKBOX VERT ================= */
        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            background: var(--white);
            border: 2px solid #e2e8f0;
            transition: all 0.2s ease;
            font-size: 0.85rem;
        }
        
        [data-theme="dark"] .filter-checkbox {
            background: #475569;
            border-color: #64748b;
        }
        
        /* Quand s√©lectionn√© : BORDURE VERTE */
        .filter-checkbox.active {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .filter-checkbox.active .filter-text {
            color: #10b981;
            font-weight: 700;
        }
        
        .filter-checkbox:hover {
            background: rgba(16, 185, 129, 0.05);
            border-color: #10b981;
        }
        
        .filter-input {
            display: none;
        }
        
        .filter-text {
            font-weight: 600;
            color: #64748b;
        }
        
        [data-theme="dark"] .filter-text {
            color: #cbd5e1;
        }
        
        /* Checkmark vert pour l'option s√©lectionn√©e */
        .filter-checkbox.active::before {
            content: "‚úì";
            color: #10b981;
            font-weight: bold;
            font-size: 0.9rem;
            margin-right: 5px;
        }
        
        /* ================= GESTION DU TH√àME GLOBAL ================= */
        .theme-sync {
            display: none; /* Cach√© mais pr√©sent pour la synchro */
        }
        
        /* ================= RESPONSIVE ================= */
        @media (max-width: 768px) {
            main {
                padding-bottom: 90px;
            }
            
            .file-title {
                font-size: 1.1rem;
                max-height: 3.3em;
            }
            
            .exercise-preview {
                max-height: 100px;
                font-size: 0.85rem;
            }
        }
        
        @media (max-width: 480px) {
            .file-title {
                font-size: 1rem;
                max-height: 3em;
            }
            
            .exercise-preview {
                max-height: 90px;
                font-size: 0.8rem;
            }
            
            .image-preview {
                max-height: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Header compact -->
    <header class="ex-header">
        <div class="ex-header-container">
            <!-- Logo rectangle - redirige vers profil.html -->
            <a href="profil.html" class="logo-rectangle">
                <img src="logo.png" alt="mathX_searcher" class="logo-img">
            </a>
            
            <!-- Barre de recherche centr√©e -->
            <div class="search-bar">
                <input type="text" 
                       class="search-input" 
                       id="exercicesSearchInput"
                       placeholder="Rechercher des exercices, cours ou images..."
                       autocomplete="off">
            </div>
        </div>
        
        <!-- Filtres dans le header - CHECKBOX avec activation individuelle -->
        <div class="header-filters">
            <div class="filter-options">
                <label class="filter-checkbox" data-filter="pdf">
                    <input type="checkbox" class="filter-input" checked data-type="pdf">
                    <span class="filter-text">PDF</span>
                </label>
                
                <label class="filter-checkbox" data-filter="txt">
                    <input type="checkbox" class="filter-input" checked data-type="txt">
                    <span class="filter-text">Exercices</span>
                </label>
                
                <label class="filter-checkbox" data-filter="image">
                    <input type="checkbox" class="filter-input" checked data-type="image">
                    <span class="filter-text">Images</span>
                </label>
            </div>
        </div>
    </header>

    <!-- Contenu principal -->
    <main>
        <!-- √âtat d'accueil (visible au d√©but) -->
        <div class="welcome-state" id="welcomeState">
            <div class="welcome-icon">
                <i class="fas fa-brain"></i>
            </div>
            <h1>Centre d'Exercices <span class="site-name">mathX</span></h1>
            <p class="welcome-subtitle">Tapez dans la barre de recherche pour d√©couvrir les exercices</p>
            <div class="welcome-tips">
                <div class="tip">
                    <i class="fas fa-search"></i>
                    <span>Commencez √† taper pour rechercher des exercices</span>
                </div>
                <div class="tip">
                    <i class="fas fa-filter"></i>
                    <span>Cliquez sur les filtres pour les activer/d√©sactiver</span>
                </div>
                <div class="tip">
                    <i class="fas fa-sync-alt"></i>
                    <span>Cliquez sur "Scanner" pour voir les nouveaux fichiers</span>
                </div>
                <div class="tip">
                    <i class="fas fa-user-circle"></i>
                    <span>Cliquez sur le logo pour acc√©der √† votre profil</span>
                </div>
            </div>
            
            <!-- Bouton pour scanner les nouveaux fichiers -->
            <button class="scan-new-files" id="scanNewFilesBtn">
                <i class="fas fa-sync-alt"></i> Scanner les nouveaux fichiers
            </button>
        </div>
        
        <!-- Message quand pas de recherche -->
        <div class="no-search-message" id="noSearchMessage" style="display: none;">
            <i class="fas fa-search fa-2x" style="margin-bottom: 15px;"></i>
            <p>Commencez √† taper dans la barre de recherche pour voir les exercices</p>
        </div>

        <!-- Conteneur pour les r√©sultats (cach√© au d√©but) -->
        <div class="results-container" id="resultsContainer" style="display: none;">
            <!-- Les cartes seront inject√©es ici dynamiquement -->
        </div>
        
        <!-- √âtat : aucun r√©sultat -->
        <div class="no-results" id="noResultsState" style="display: none;">
            <i class="fas fa-search fa-2x" style="margin-bottom: 15px; color: #94a3b8;"></i>
            <p>Aucun r√©sultat trouv√©. Essayez d'autres termes de recherche.</p>
            <button class="scan-new-files" id="rescanBtn" style="margin-top: 20px;">
                <i class="fas fa-sync-alt"></i> Re-scanner les fichiers
            </button>
        </div>
        
        <!-- √âtat : chargement en cours -->
        <div class="loading-state" id="loadingState" style="display: none;">
            <div class="spinner"></div>
            <p>Chargement des exercices...</p>
        </div>
    </main>

    <!-- Navigation bas fixe -->
    <nav class="bottom-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-tab">
                <i class="fas fa-search"></i>
                <span class="tab-label">Recherche</span>
            </a>
            
            <a href="exercices.html" class="nav-tab active">
                <i class="fas fa-pen-to-square"></i>
                <span class="tab-label">Exercices</span>
            </a>
        </div>
    </nav>

    <!-- √âl√©ment cach√© pour la synchronisation du th√®me -->
    <div class="theme-sync" id="themeSync"></div>

    <!-- JavaScript -->
    <script src="exercices.js"></script>
    
    <!-- Script pour la gestion du th√®me global -->
    <script>
        // ================= GESTION DU TH√àME GLOBAL =================
        
        function applyGlobalTheme() {
            // V√©rifier le th√®me sauvegard√©
            const savedTheme = localStorage.getItem('mathx_theme');
            const isDarkMode = localStorage.getItem('mathx_dark_mode') === 'true';
            
            if (savedTheme === 'dark' || isDarkMode) {
                // Appliquer le th√®me dark
                document.documentElement.setAttribute('data-theme', 'dark');
                console.log('üåô Th√®me dark appliqu√© (exercices.html)');
            } else {
                // Appliquer le th√®me light
                document.documentElement.setAttribute('data-theme', 'light');
                console.log('‚òÄÔ∏è Th√®me light appliqu√© (exercices.html)');
            }
        }
        
        // √âcouter les changements de th√®me depuis d'autres pages
        window.addEventListener('storage', (e) => {
            if (e.key === 'mathx_theme' || e.key === 'mathx_dark_mode') {
                console.log('üîÑ Changement de th√®me d√©tect√© depuis une autre page');
                applyGlobalTheme();
            }
        });
        
        // √âcouter les √©v√©nements personnalis√©s (si utilis√©s par profil.js)
        window.addEventListener('themeChanged', (e) => {
            if (e.detail && e.detail.theme) {
                document.documentElement.setAttribute('data-theme', e.detail.theme);
                console.log(`üé® Th√®me chang√© via √©v√©nement: ${e.detail.theme}`);
            }
        });
        
        // Appliquer le th√®me au chargement
        document.addEventListener('DOMContentLoaded', function() {
            applyGlobalTheme();
            
            // Ajouter un indicateur visuel du th√®me (optionnel pour d√©bogage)
            const themeIndicator = document.createElement('div');
            themeIndicator.id = 'theme-indicator';
            themeIndicator.style.cssText = `
                position: fixed;
                top: 10px;
                left: 10px;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                z-index: 9999;
                pointer-events: none;
                opacity: 0.3;
            `;
            
            const updateThemeIndicator = () => {
                const theme = document.documentElement.getAttribute('data-theme');
                themeIndicator.style.background = theme === 'dark' ? '#000' : '#fff';
                themeIndicator.style.boxShadow = theme === 'dark' 
                    ? '0 0 10px white' 
                    : '0 0 10px black';
            };
            
            document.body.appendChild(themeIndicator);
            updateThemeIndicator();
            
            // Surveiller les changements d'attribut
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.attributeName === 'data-theme') {
                        updateThemeIndicator();
                        console.log('üé® Th√®me modifi√© en direct');
                    }
                });
            });
            
            observer.observe(document.documentElement, {
                attributes: true,
                attributeFilter: ['data-theme']
            });
        });
        
        // Fonction pour forcer la mise √† jour du th√®me (peut √™tre appel√©e depuis profil.js)
        window.updateThemeFromProfile = function(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('mathx_theme', theme);
            localStorage.setItem('mathx_dark_mode', theme === 'dark' ? 'true' : 'false');
            
            // √âmettre un √©v√©nement pour synchroniser avec index.html
            window.dispatchEvent(new CustomEvent('themeChanged', {
                detail: { theme: theme }
            }));
            
            console.log(`üîÅ Th√®me synchronis√© depuis profil: ${theme}`);
        };
        
        // Exposer la fonction pour le profil
        window.applyGlobalTheme = applyGlobalTheme;
    </script>
</body>
</html>