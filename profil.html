<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Profil - mathX_searcher</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="logique.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="profil.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    
    <!-- Configuration Firebase -->
    <script src="firebase-config.js" defer></script>
</head>
<body class="profile-page">
    <!-- Affichage instantané -->
    <script>
    (function() {
        // Afficher données préchargées IMMÉDIATEMENT
        const profileData = localStorage.getItem('mathx_profile_data');
        const profileTime = localStorage.getItem('mathx_profile_timestamp');
        
        if (profileData && profileTime) {
            const age = Date.now() - parseInt(profileTime);
            if (age < 10 * 60 * 1000) {
                document.addEventListener('DOMContentLoaded', function() {
                    try {
                        const data = JSON.parse(profileData);
                        
                        // Avatar
                        const avatar = document.getElementById('userAvatar');
                        if (avatar && data.avatarLetter) {
                            avatar.src = `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><rect width="120" height="120" fill="%233b82f6"/><text x="50%" y="50%" font-family="Arial" font-size="60" fill="white" text-anchor="middle" dy=".3em" font-weight="bold">${data.avatarLetter}</text></svg>`;
                        }
                        
                        // Nom
                        if (data.name) {
                            const nameEl = document.getElementById('userName');
                            const fullNameEl = document.getElementById('userFullName');
                            if (nameEl) nameEl.textContent = data.name;
                            if (fullNameEl) fullNameEl.textContent = data.name;
                        }
                        
                        // Email
                        if (data.email) {
                            const emailEl = document.getElementById('userEmail');
                            if (emailEl) emailEl.textContent = data.email;
                        }
                        
                        // Niveau
                        if (data.level) {
                            const levelEl = document.getElementById('userLevel');
                            if (levelEl) levelEl.textContent = data.level;
                        }
                        
                        // Dernière connexion
                        const loginEl = document.getElementById('lastLogin');
                        if (loginEl) {
                            const now = new Date();
                            loginEl.textContent = `Aujourd'hui à ${now.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}`;
                        }
                        
                        // Date inscription
                        if (data.creationTime) {
                            const sinceEl = document.getElementById('memberSince');
                            if (sinceEl) {
                                const date = new Date(data.creationTime);
                                sinceEl.textContent = date.toLocaleDateString('fr-FR', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                });
                            }
                        }
                        
                        console.log('⚡ Affichage instantané');
                        
                    } catch (e) {
                        console.warn('⚠️ Erreur données cache:', e);
                    }
                });
            }
        }
    })();
    </script>

    <!-- Header -->
    <header class="profile-header">
        <div class="header-container">
            <div class="header-left">
                <a href="index.html" class="logo-link">
                    <div class="header-logo">
                        <img src="logo.png" alt="mathX Logo" class="logo-img">
                    </div>
                </a>
            </div>
            
            <div class="header-center"></div>
            
            <div class="header-right">
                <a href="index.html" class="home-btn">
                    <i class="fas fa-home"></i>
                    <span>Accueil</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Contenu principal -->
    <main class="profile-main">
        <!-- Carte Profil -->
        <div class="profile-card">
            <!-- Section Avatar -->
            <div class="avatar-section">
                <div class="profile-avatar">
                    <img id="userAvatar" src="" alt="Avatar">
                </div>
                <h2 id="userName"></h2>
            </div>
            
            <!-- Section Informations -->
            <div class="info-section">
                <div class="info-item">
                    <div class="info-header">
                        <i class="fas fa-user"></i>
                        <h3>Nom Complet</h3>
                    </div>
                    <p class="info-content" id="userFullName"></p>
                </div>
                
                <div class="info-item">
                    <div class="info-header">
                        <i class="fas fa-graduation-cap"></i>
                        <h3>Niveau Scolaire</h3>
                    </div>
                    <p class="info-content" id="userLevel">Non défini</p>
                </div>
                
                <div class="info-item">
                    <div class="info-header">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Date de Connexion</h3>
                    </div>
                    <p class="info-content" id="lastLogin">Aujourd'hui</p>
                </div>
                
                <div class="info-item">
                    <div class="info-header">
                        <i class="fas fa-calendar-plus"></i>
                        <h3>Membre Depuis</h3>
                    </div>
                    <p class="info-content" id="memberSince"></p>
                </div>
            </div>
            
            <!-- Section Email -->
            <div class="email-section">
                <div class="email-header">
                    <i class="fas fa-envelope"></i>
                    <h3>Adresse Email</h3>
                </div>
                <p class="email-content" id="userEmail"></p>
            </div>
        </div>

        <!-- Section Paramètres -->
        <div class="settings-section">
            <!-- Thème light/dark -->
            <div class="settings-group">
                <h3 class="settings-title">
                    <i class="fas fa-palette"></i> Thème d'affichage
                </h3>
                <div class="theme-toggle">
                    <span class="theme-label">Mode clair</span>
                    <label class="switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="slider"></span>
                    </label>
                    <span class="theme-label">Mode sombre</span>
                </div>
            </div>

            <!-- Filtres par défaut -->
            <div class="settings-group">
                <h3 class="settings-title">
                    <i class="fas fa-filter"></i> Filtres de recherche par défaut
                </h3>
                <div class="default-filters">
                    <label class="filter-option">
                        <input type="checkbox" id="filterMath" checked>
                        <span class="filter-checkbox"></span>
                        <span class="filter-text">Mathématiques</span>
                    </label>
                    
                    <label class="filter-option">
                        <input type="checkbox" id="filterPhysique" checked>
                        <span class="filter-checkbox"></span>
                        <span class="filter-text">Physique</span>
                    </label>
                    
                    <label class="filter-option">
                        <input type="checkbox" id="filterProfessionnel" checked>
                        <span class="filter-checkbox"></span>
                        <span class="filter-text">Professionnel</span>
                    </label>
                </div>
            </div>

            <!-- Partage du site -->
            <div class="settings-group">
                <h3 class="settings-title">
                    <i class="fas fa-share-alt"></i> Partager le site
                </h3>
                <div class="share-buttons">
                    <button class="share-btn whatsapp-btn" id="shareWhatsApp">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </button>
                    
                    <button class="share-btn facebook-btn" id="shareFacebook">
                        <i class="fab fa-facebook"></i>
                        <span>Facebook</span>
                    </button>
                </div>
            </div>

            <!-- Version du site -->
            <div class="settings-group">
                <h3 class="settings-title">
                    <i class="fas fa-code-branch"></i> Version
                </h3>
                <div class="version-info">
                    <p class="version-text">
                        <i class="fas fa-info-circle"></i>
                        Version actuelle: <span id="siteVersion">v1.0.0</span>
                    </p>
                    <p class="version-date">
                        <i class="fas fa-calendar-alt"></i>
                        Dernière mise à jour: <span id="lastUpdateDate">Chargement...</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Bouton Déconnexion -->
        <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Se déconnecter</span>
        </button>
    </main>

    <!-- Navigation bas -->
    <nav class="bottom-nav standalone-nav">
        <div class="nav-container">
            
            <a href="exercices.html" class="nav-tab">
                <i class="fas fa-pen-to-square"></i>
                <span class="tab-label">Exercices</span>
            </a>
            
            <a href="profil.html" class="nav-tab active">
                <i class="fas fa-user"></i>
                <span class="tab-label">Profil</span>
            </a>
        </div>
    </nav>

    <!-- Scripts -->
    <script src="auth.js" defer></script>
    <script src="profil.js"></script>
</body>
</html>
